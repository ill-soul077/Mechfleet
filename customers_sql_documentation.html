<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customers Page - SQL CRUD Testing</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
        pre { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .query-box { background: #fff; border: 2px solid #3498db; border-radius: 5px; padding: 15px; margin: 15px 0; }
        .query-title { font-weight: bold; color: #2980b9; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background: #f2f2f2; }
        .btn { display: inline-block; padding: 10px 20px; margin: 10px 5px 10px 0; background: #3498db; color: white; text-decoration: none; border-radius: 5px; }
        .btn:hover { background: #2980b9; }
        ul { line-height: 1.8; }
    </style>
</head>
<body>
    <h1>‚úÖ Customers Page - SQL CRUD Operations Documentation</h1>
    
    <div class="success">
        <strong>‚úì Status:</strong> The customers.php page is already using BASIC SQL queries for all CRUD operations!<br>
        <strong>‚úì Database:</strong> Connected to <code>mechfleet</code> with 50 customers loaded<br>
        <strong>‚úì Security:</strong> Using PDO prepared statements with named parameters
    </div>

    <div class="info">
        <strong>üìç Page URL:</strong> <a href="http://localhost/Mechfleet/public/customers.php" target="_blank">http://localhost/Mechfleet/public/customers.php</a><br>
        <strong>üìÇ File Location:</strong> <code>E:\Xampp\htdocs\Mechfleet\public\customers.php</code>
    </div>

    <h2>üîç SQL Queries Used (No PL/SQL or Stored Procedures)</h2>

    <div class="query-box">
        <div class="query-title">1. CREATE (INSERT) - Add New Customer</div>
        <p><strong>When:</strong> User fills out "Add Customer" form and clicks "Create"</p>
        <pre>INSERT INTO customer (
    first_name, last_name, email, phone, 
    address, city, state, zip_code
) VALUES (
    :fn, :ln, :em, :ph, :ad, :ci, :st, :zip
);</pre>
        <p><strong>Parameters:</strong> All values are bound using PDO named parameters (:fn, :ln, etc.)</p>
        <p><strong>Validation:</strong> Checks first_name, last_name, email (must be valid), phone (all required)</p>
    </div>

    <div class="query-box">
        <div class="query-title">2. READ (SELECT) - Retrieve Customers</div>
        <p><strong>When:</strong> Page loads or user navigates to customers page</p>
        <p><strong>2a. List All Customers:</strong></p>
        <pre>SELECT * FROM customer 
ORDER BY customer_id DESC 
LIMIT 200;</pre>
        
        <p><strong>2b. Get Specific Customer (for editing):</strong></p>
        <pre>SELECT * FROM customer 
WHERE customer_id = :id;</pre>
    </div>

    <div class="query-box">
        <div class="query-title">3. UPDATE - Modify Existing Customer</div>
        <p><strong>When:</strong> User clicks "Edit", modifies data, and clicks "Update"</p>
        <pre>UPDATE customer 
SET first_name=:fn, last_name=:ln, email=:em, phone=:ph,
    address=:ad, city=:ci, state=:st, zip_code=:zip
WHERE customer_id = :id;</pre>
        <p><strong>Note:</strong> All fields are updated together, validated before execution</p>
    </div>

    <div class="query-box">
        <div class="query-title">4. DELETE - Remove Customer</div>
        <p><strong>When:</strong> User clicks "Delete" button and confirms the deletion</p>
        <pre>DELETE FROM customer 
WHERE customer_id = :id;</pre>
        <p><strong>‚ö†Ô∏è Constraint:</strong> Will fail if customer has vehicles (foreign key constraint ON DELETE RESTRICT)</p>
    </div>

    <h2>üõ°Ô∏è Security Features</h2>
    <ul>
        <li><strong>PDO Prepared Statements:</strong> All queries use prepared statements to prevent SQL injection</li>
        <li><strong>Named Parameters:</strong> Uses :fn, :ln, :em, etc. instead of raw values</li>
        <li><strong>Input Validation:</strong> PHP validates required fields and email format before database operations</li>
        <li><strong>Error Handling:</strong> Try-catch blocks handle database errors gracefully</li>
        <li><strong>CSRF Protection:</strong> Forms use POST method (GET only for reading)</li>
    </ul>

    <h2>üìã Database Constraints</h2>
    <table>
        <thead>
            <tr>
                <th>Column</th>
                <th>Constraint</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>customer_id</td>
                <td>PRIMARY KEY, AUTO_INCREMENT</td>
                <td>Unique identifier, automatically generated</td>
            </tr>
            <tr>
                <td>email</td>
                <td>UNIQUE</td>
                <td>No duplicate emails allowed</td>
            </tr>
            <tr>
                <td>phone</td>
                <td>INDEXED</td>
                <td>Fast lookup by phone number</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>DEFAULT CURRENT_TIMESTAMP</td>
                <td>Automatically set on insert</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>ON UPDATE CURRENT_TIMESTAMP</td>
                <td>Automatically updated on modify</td>
            </tr>
        </tbody>
    </table>

    <h2>‚ú® Features on the Page</h2>
    <ul>
        <li><strong>Form Validation:</strong> Client-side HTML5 validation (required fields, email format)</li>
        <li><strong>Server-side Validation:</strong> PHP validates all inputs before database operations</li>
        <li><strong>Edit Mode:</strong> Click "Edit" to populate form with existing data</li>
        <li><strong>Delete Confirmation:</strong> JavaScript confirm dialog before deletion</li>
        <li><strong>Success/Error Messages:</strong> User feedback after each operation</li>
        <li><strong>Recent List:</strong> Shows last 200 customers in descending order</li>
    </ul>

    <h2>üß™ Test the Page</h2>
    <p>You can test all CRUD operations:</p>
    <a href="http://localhost/Mechfleet/public/customers.php" class="btn" target="_blank">Open Customers Page</a>
    
    <h3>Test Scenarios:</h3>
    <ol>
        <li><strong>Create:</strong> Fill out the form and click "Create" to add a new customer</li>
        <li><strong>Read:</strong> View the list of customers on the right side</li>
        <li><strong>Update:</strong> Click "Edit" next to any customer, modify data, click "Update"</li>
        <li><strong>Delete:</strong> Click "Delete" next to any customer (confirm when prompted)</li>
    </ol>

    <h2>üìÑ Related Files</h2>
    <ul>
        <li><code>E:\Xampp\htdocs\Mechfleet\public\customers.php</code> - Main customer management page</li>
        <li><code>E:\Xampp\htdocs\Mechfleet\includes\db.php</code> - Database connection (PDO)</li>
        <li><code>E:\Xampp\htdocs\Mechfleet\includes\config.php</code> - Database configuration</li>
        <li><code>E:\Xampp\htdocs\Mechfleet\sql\queries\customers_crud_queries.sql</code> - SQL reference documentation</li>
    </ul>

    <div class="success" style="margin-top: 30px;">
        <strong>‚úÖ Conclusion:</strong> The customers.php page is fully functional with basic SQL CRUD operations. No PL/SQL or stored procedures are used. All queries are secure using PDO prepared statements.
    </div>
</body>
</html>
